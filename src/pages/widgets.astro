---
import WidgetManager from "../components/react/WidgetManager";
import Layout from "../layouts/Layout.astro";

// Discover all widget pages automatically
const widgetPages = await import.meta.glob("../pages/**/*.astro", {
  eager: true,
});

const allWidgets = Object.entries(widgetPages)
  .filter(([path, page]: [string, any]) => page.isWidget === true)
  .map(([path, page]: [string, any]) => {
    const urlPath = path.replace(/^\.\.\/pages/, "").replace(/\.astro$/, "");
    return {
      id: urlPath.split("/").filter(Boolean).pop(),
      url: urlPath,
      name: page.title,
      description: page.description,
      category: page.category,
      icon: page.icon,
    };
  });

console.log(allWidgets);
---

<Layout title="Widget Management - Open Widgets">
  <div class="min-h-screen bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto">
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-800">Widget Management</h1>
        <p class="text-gray-600">
          Search, filter, and manage your widgets using React. New widgets are
          discovered automatically.
        </p>
      </div>
      <WidgetManager client:load widgets={allWidgets} />
    </div>
  </div>
</Layout>
